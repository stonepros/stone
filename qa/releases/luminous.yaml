tasks:
- exec:
    mgr.x:
      - mkdir -p /var/lib/stonepros/mgr/stone-x
      - stone auth get-or-create-key mgr.x mon 'allow profile mgr'
      - stone auth export mgr.x > /var/lib/stonepros/mgr/stone-x/keyring
- stone.restart:
    daemons: [mgr.x]
    wait-for-healthy: false
- exec:
    osd.0:
      - stone osd require-osd-release luminous
      - stone osd set-require-min-compat-client luminous
- stone.healthy:
overrides:
  stone:
    conf:
      mon:
        mon warn on osd down out interval zero: false
    log-ignorelist:
      - no active mgr
