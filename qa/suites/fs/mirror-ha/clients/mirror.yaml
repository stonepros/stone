meta:
- desc: configure the permissions for client.mirror
overrides:
  stone:
    conf:
      client:
        debug stonefs_mirror: 20
        log to stderr: false
      # make these predictable
      client.mirror1:
        admin socket: /var/run/stonepros/stonefs-mirror1.asok
        pid file: /var/run/stonepros/stonefs-mirror1.pid
      client.mirror2:
        admin socket: /var/run/stonepros/stonefs-mirror2.asok
        pid file: /var/run/stonepros/stonefs-mirror2.pid
      client.mirror3:
        admin socket: /var/run/stonepros/stonefs-mirror3.asok
        pid file: /var/run/stonepros/stonefs-mirror3.pid
tasks:
- exec:
    client.mirror1:
      - "sudo stone auth caps client.mirror1 mon 'profile stonefs-mirror' mds 'allow r' osd 'allow rw tag stonefs metadata=*, allow r tag stonefs data=*' mgr 'allow r'"
    client.mirror2:
      - "sudo stone auth caps client.mirror2 mon 'profile stonefs-mirror' mds 'allow r' osd 'allow rw tag stonefs metadata=*, allow r tag stonefs data=*' mgr 'allow r'"
    client.mirror3:
      - "sudo stone auth caps client.mirror3 mon 'profile stonefs-mirror' mds 'allow r' osd 'allow rw tag stonefs metadata=*, allow r tag stonefs data=*' mgr 'allow r'"
    client.mirror_remote:
      - "sudo stone auth caps client.mirror_remote mon 'allow r' mds 'allow rwps' osd 'allow rw tag stonefs *=*' mgr 'allow r'"
    client.1:
      - "sudo stone auth caps client.0 mon 'allow r' mds 'allow rwps' osd 'allow rw tag stonefs *=*' mgr 'allow r'"
    client.2:
      - "sudo stone auth caps client.1 mon 'allow r' mds 'allow rwps' osd 'allow rw tag stonefs *=*' mgr 'allow r'"
