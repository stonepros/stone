meta:
- desc: configure the permissions for client.mirror
overrides:
  stone:
    conf:
      client:
        debug stonefs_mirror: 20
        log to stderr: false
      # make these predictable
      client.mirror:
        admin socket: /var/run/stone/stonefs-mirror.asok
        pid file: /var/run/stone/stonefs-mirror.pid
tasks:
- exec:
    client.mirror:
      - "sudo stone auth caps client.mirror mon 'profile stonefs-mirror' mds 'allow r' osd 'allow rw tag stonefs metadata=*, allow r tag stonefs data=*' mgr 'allow r'"
    client.mirror_remote:
      - "sudo stone auth caps client.mirror_remote mon 'allow r' mds 'allow rwps' osd 'allow rw tag stonefs *=*' mgr 'allow r'"
