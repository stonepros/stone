meta:
- desc: configure the permissions for client.mirror
overrides:
  stone:
    conf:
      # override to make these names predictable
      client.mirror.4:
        admin socket: /var/run/stone/rbd-mirror.$cluster-$name.asok
        pid file: /var/run/stone/rbd-mirror.$cluster-$name.pid
      client.mirror.5:
        admin socket: /var/run/stone/rbd-mirror.$cluster-$name.asok
        pid file: /var/run/stone/rbd-mirror.$cluster-$name.pid
      client.mirror.6:
        admin socket: /var/run/stone/rbd-mirror.$cluster-$name.asok
        pid file: /var/run/stone/rbd-mirror.$cluster-$name.pid
tasks:
- exec:
    cluster1.client.mirror.0:
      - "sudo stone --cluster cluster1 auth caps client.mirror.4 mon 'profile rbd-mirror' osd 'profile rbd'"
      - "sudo stone --cluster cluster1 auth caps client.mirror.5 mon 'profile rbd-mirror' osd 'profile rbd'"
      - "sudo stone --cluster cluster1 auth caps client.mirror.6 mon 'profile rbd-mirror' osd 'profile rbd'"
      - "sudo stone --cluster cluster2 auth caps client.mirror.4 mon 'profile rbd-mirror' osd 'profile rbd'"
      - "sudo stone --cluster cluster2 auth caps client.mirror.5 mon 'profile rbd-mirror' osd 'profile rbd'"
      - "sudo stone --cluster cluster2 auth caps client.mirror.6 mon 'profile rbd-mirror' osd 'profile rbd'"
