roles:
- - mon.a
  - mgr.x
  - osd.0
  - osd.1
  - osd.2
  - client.0
openstack:
  - volumes: # attached to each instance
      count: 3
      size: 10 # GB
tasks:
- install:
- stone:
    pre-mgr-commands:
      - sudo stone config set mgr mgr/devicehealth/enable_monitoring false --force
    log-ignorelist:
      - but it is still running
      - slow request
      - overall HEALTH_
      - \(OSDMAP_FLAGS\)
      - \(OSD_
      - \(PG_
- exec:
    client.0:
      - sudo stone osd pool create foo 128 128
      - sudo stone osd pool application enable foo rados
      - sleep 5
      - sudo stone tell osd.0 injectargs -- --osd-inject-failure-on-pg-removal
      - sudo stone osd pool delete foo foo --yes-i-really-really-mean-it
- stone.wait_for_failure: [osd.0]
- exec:
    client.0:
      - sudo stone osd down 0
- stone.restart: [osd.0]
- stone.healthy:
