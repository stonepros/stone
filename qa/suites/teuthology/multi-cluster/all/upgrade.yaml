overrides:
  stone:
    log-ignorelist:
    - failed to encode map
  conf:
    mon:
      mon warn on legacy crush tunables: false
roles:
- - stone.mon.a
  - stone.mon.b
  - stone.mgr.x
  - backup.osd.0
  - backup.osd.1
  - backup.osd.2
  - backup.client.0
- - backup.mon.a
  - backup.mgr.x
  - stone.osd.0
  - stone.osd.1
  - stone.osd.2
  - stone.client.0
  - client.1
  - osd.3
tasks:
- install:
    branch: infernalis
- stone:
    cluster: backup
- stone:
- workunit:
    clients:
      backup.client.0: [true.sh]
      stone.client.0: [true.sh]
- install.upgrade:
    stone.mon.a:
      branch: jewel
    backup.mon.a:
      branch: jewel
- stone.restart: [stone.mon.a, stone.mon.b, stone.osd.0, stone.osd.1, stone.osd.2, osd.3]
- exec:
    stone.client.0:
    - stone --version | grep -F 'version 10.'
    client.1:
    - stone --cluster backup --version | grep -F 'version 10.'
    backup.client.0:
    # cli upgraded
    - stone --cluster backup --id 0 --version | grep -F 'version 10.'
    - stone --version | grep -F 'version 10.'
    # backup cluster mon not upgraded
    - stone --cluster backup --id 0 tell mon.a version | grep -F 'version 9.2.'
    - stone tell mon.a version | grep -F 'version 10.'
